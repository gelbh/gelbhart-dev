<% meta = page_meta %>
<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
  <head>
    <%= render 'shared/google_analytics' %>

    <%# Document Metadata %>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
    <title><%= meta.title %></title>

    <%# SEO Meta Tags %>
    <meta name="description" content="<%= meta.description %>">
    <meta name="author" content="Tomer Gelbhart - Full-Stack Developer, MSc Computer Science Student at UCD">
    <meta name="language" content="English">
    <meta name="robots" content="index, follow">
    <% if meta.keywords.present? %>
      <meta name="keywords" content="<%= meta.keywords %>">
    <% end %>
    <link rel="canonical" href="<%= meta.url %>">

    <%# Open Graph Meta Tags %>
    <meta property="og:type" content="<%= meta.og_type %>">
    <meta property="og:locale" content="en_IE">
    <meta property="og:site_name" content="gelbhart.dev">
    <meta property="og:url" content="<%= meta.url %>">
    <meta property="og:title" content="<%= meta.title %>">
    <meta property="og:description" content="<%= meta.description %>">
    <meta property="og:image" content="<%= meta.image %>">
    <meta property="og:image:secure_url" content="<%= meta.image.gsub('http://', 'https://') %>">
    <meta property="og:image:type" content="image/png">
    <meta property="og:image:width" content="<%= meta.image_dimensions[:width] %>">
    <meta property="og:image:height" content="<%= meta.image_dimensions[:height] %>">
    <meta property="og:image:alt" content="Tomer Gelbhart - Full-Stack Developer Portfolio">
    <meta property="og:updated_time" content="<%= meta.updated_time %>">
    <% if meta.og_type == 'article' %>
      <meta property="article:author" content="Tomer Gelbhart">
    <% end %>

    <%# Twitter Card Meta Tags %>
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="<%= meta.url %>">
    <meta name="twitter:title" content="<%= meta.title %>">
    <meta name="twitter:description" content="<%= meta.description %>">
    <meta name="twitter:image" content="<%= meta.image %>">
    <meta name="twitter:image:alt" content="Tomer Gelbhart - Full-Stack Developer Portfolio">

    <%# Additional Meta Tags %>
    <meta name="theme-color" content="#0d6efd">
    <meta name="format-detection" content="telephone=no">

    <%# Security Tags %>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%# Favicon and App Icons %>
    <%= favicon_link_tag '/favicon.ico' %>
    <%= favicon_link_tag '/icons/favicons/favicon.svg', rel: 'icon', type: 'image/svg+xml' %>
    <%= favicon_link_tag '/icons/favicons/favicon-16x16.png', rel: 'icon', sizes: '16x16', type: 'image/png' %>
    <%= favicon_link_tag '/icons/favicons/favicon-32x32.png', rel: 'icon', sizes: '32x32', type: 'image/png' %>
    <%= favicon_link_tag '/icons/favicons/favicon-96x96.png', rel: 'icon', sizes: '96x96', type: 'image/png' %>
    <%= favicon_link_tag '/apple-touch-icon.png', rel: 'apple-touch-icon', sizes: '192x192', type: 'image/png' %>
    <meta name="apple-mobile-web-app-title" content="T. Gelbhart">
    <%= tag :link, rel: 'manifest', href: asset_path('/site.webmanifest') %>
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-config" content="/browserconfig.xml">

    <%# Resource Hints - Critical External Domains %>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://www.googletagmanager.com">
    <link rel="dns-prefetch" href="https://www.google-analytics.com">

    <%# Resource Hints - CDN Domains %>
    <link rel="dns-prefetch" href="https://unpkg.com">
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="https://ga.jspm.io">
    <link rel="dns-prefetch" href="https://esm.sh">

    <%# Resource Hints - Page-Specific (NASA Exoplanet Explorer) %>
    <% if request.path == '/projects/nasa-exoplanet-explorer' %>
      <link rel="preconnect" href="https://nasa-exoplanet-explorer.vercel.app">
      <link rel="dns-prefetch" href="https://nasa-exoplanet-explorer.onrender.com">
    <% end %>

    <%# Fonts %>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    <noscript>
      <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    </noscript>

    <%# Icon Fonts %>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.2.3/css/flag-icons.min.css">

    <%# Structured Data (JSON-LD) %>
    <%= render_structured_data(person_structured_data) %>
    <%= render_structured_data(website_structured_data) %>
    <%= render_structured_data(organization_structured_data) %>

    <%# WebPage structured data for current page %>
    <% webpage_data = webpage_structured_data(
      name: meta.title,
      url: meta.url,
      description: meta.description,
      date_published: content_for?(:date_published) ? content_for(:date_published) : nil,
      date_modified: content_for?(:date_modified) ? content_for(:date_modified) : nil
    ) %>
    <%= render_structured_data(webpage_data) %>

    <%# Page-specific structured data %>
    <% if content_for?(:structured_data) %>
      <%= yield(:structured_data) %>
    <% end %>

    <%# Critical CSS %>
    <style>
      :root{--si-primary:#6366f1;--si-font-sans-serif:"Manrope",sans-serif}body{font-family:var(--si-font-sans-serif);margin:0;padding:0;min-height:100vh}.page-wrapper{display:flex;flex-direction:column;min-height:100vh}.header{position:fixed;top:0;left:0;width:100%;z-index:1030;background-color:rgba(11,15,25,0.8);backdrop-filter:blur(8px);transition:background-color 0.2s ease-in-out}.container{width:100%;padding-right:1rem;padding-left:1rem;margin-right:auto;margin-left:auto}.header-logo{width:47px;height:47px;transition:transform 0.3s ease}.text-center{text-align:center}@media (min-width:992px){.container{max-width:960px}.text-lg-start{text-align:left}}
    </style>

    <%# Application Stylesheets %>
    <link rel="preload" href="<%= stylesheet_path('application') %>" as="style">
    <%= stylesheet_link_tag "application", media: "all" %>

    <%# Expose asset_path helper for JavaScript %>
    <script>
      window.assetPath = function(path) {
        const assetPaths = {
          "cbms-json-schema.json": "<%= asset_path('cbms-json-schema.json') %>"
        };
        return assetPaths[path] || `/assets/${path}`;
      };
    </script>
    <%= javascript_importmap_tags %>
  </head>

  <body>
    <main class="page-wrapper">
      <% unless controller_name == 'errors' %>
        <%= render 'shared/header' %>
      <% end %>

      <div class="container <%= 'mt-1 py-1 min-vh-100' unless controller_name == 'errors' %>">
        <%= yield %>
      </div>

      <% unless controller_name == 'errors' %>
        <%= render 'shared/footer' %>
        <%= link_to "#top", class: "btn-scroll-top", data: { scroll: "" } do %>
          <span class="btn-scroll-top-tooltip text-muted fs-sm me-2">Top</span>
          <i class="btn-scroll-top-icon bx bx-chevron-up"></i>
        <% end %>
      <% end %>
    </main>
  </body>
</html>