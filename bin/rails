#!/usr/bin/env ruby
# Start SimpleCov before Rails loads for accurate coverage tracking
# Only start SimpleCov when COVERAGE=true is set (slower but accurate coverage)
# Rails 8+ loads config/application.rb before test_helper.rb, so we need to start SimpleCov here
if ENV["RAILS_ENV"] == "test" && ENV["COVERAGE"] == "true" && !defined?(SimpleCov)
  require "simplecov"
  SimpleCov.merge_timeout 3600
  SimpleCov.command_name "rails test"
  SimpleCov.start "rails" do
    add_filter "/test/"
    add_filter "/config/"
    add_filter "/db/"
    add_filter "/vendor/"
    add_filter "/lib/tasks/"
    minimum_coverage 80
  end
end

APP_PATH = File.expand_path("../config/application", __dir__)
require_relative "../config/boot"
require "rails/commands"
